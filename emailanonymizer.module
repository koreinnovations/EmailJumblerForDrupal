<?php

module_load_include('inc', 'emailanonymizer', 'includes/util');
module_load_include('inc', 'emailanonymizer', 'includes/forms');

/**
 * Implements hook_perm(). 
 */
function emailanonymizer_perm() {
  $items = array();

  $items[] = 'administer email anonymizer';

  return $items;
}

/**
 * Implements hook_menu(). 
 */
function emailanonymizer_menu() {
  $items = array();

  $items['admin/settings/emailanonymizer'] = array(
      'title' => 'Email Anonymizer',
      'page callback' => 'drupal_get_form',
      'page arguments' => array('emailanonymizer_admin_settings_form'),
      'access arguments' => array('administer email anonymizer'),
      'file' => 'includes/admin.inc',
  );

  return $items;
}

function emailanonymizer_form_alter(&$form, &$form_state, $form_id) {
  if ($form_id == 'comment_form') {
    $form['expose_fake_email'] = array(
        '#type' => 'checkbox',
        '#title' => t('Generate a fake email address and allow people to contact me that way'),
        '#description' => t('Your "fake" email is a safe, secure way for people to contact you.  You will receive emails at your normal email address, but nobody will see your real email address.'),
    );
    $form['#submit'][] = 'emailanonymizer_custom_comment_submit';
  }
}